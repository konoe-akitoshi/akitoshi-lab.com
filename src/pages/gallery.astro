---
import Layout from "../layouts/Layout.astro";
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";
import GalleryComponent from "../components/svelte/Gallery.svelte";

// フォルダ内の画像を動的にインポート
const imageFiles = import.meta.glob<{ default: ImageMetadata }>('../assets/img/gallery/*', { eager: true });

// 画像データの配列を作成
const images = Object.entries(imageFiles).map(([path, module]) => {
  // ファイル名を取得（パスから抽出）
  const filename = path.split('/').pop() || '';
  // ファイル名から拡張子を除去してタイトルとして使用
  const title = filename.replace(/\.[^/.]+$/, "");
  
  return {
    src: module.default.src,
    alt: `Gallery image ${filename}`,
    title: title
  };
});

// 画像をランダムに並び替え（重複なし）
// Set を使用して一意の画像を確保
const uniqueImages = Array.from(new Set(images.map(img => img.src)))
  .map(src => images.find(img => img.src === src))
  .filter((img): img is typeof images[0] => img !== undefined); // undefinedを除外

const shuffledImages = [...uniqueImages].sort(() => Math.random() - 0.5);
---

<Layout
  title="Gallery | Akitoshi Lab."
  description="モダンなギャラリーページ。様々な作品を展示しています。"
  ogImage="/img/OGP.webp"
  bodyClass="m-0 p-0 font-snself overflow-x-hidden"
  useMainWrapper={false}
>
  <div class="gallery-page">
    <div class="gallery-header">
      <h2 class="gallery-title">GALLERY</h2>
    </div>
    
    <GalleryComponent client:load images={shuffledImages} />
  </div>
</Layout>

<style>
  .gallery-page {
    width: 100%;
    min-height: 100vh;
    padding: 3rem 0 5rem;
    margin: 0;
  }

  .gallery-header {
    padding: 2rem 0 3rem;
    text-align: center;
    margin: 0 auto;
  }

  .gallery-title {
    font-size: 1rem;
    font-weight: normal;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 1.5rem;
  }
</style>
